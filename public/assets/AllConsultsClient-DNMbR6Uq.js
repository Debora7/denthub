import{r as d,T as Ce,h as f,k as xe,o as l,f as i,a as m,u as v,w as $,F as g,Z as De,b as s,i as P,m as Z,p as F,q as h,n as w,e as k,t as c,g as G,d as O,s as Te,x as $e}from"./app-m8O9x8db.js";import{_ as Pe}from"./AuthenticatedLayout-oP7uY6wx.js";import{P as X}from"./PrimaryButton-D-IF3Vpv.js";import{_ as Oe,a as Ve}from"./Modal-90c__Ftz.js";import{t as Ie}from"./toastr.min-sOBkje4z.js";import{_ as Le}from"./ModalReview-C2_nYjY-.js";import{s as Me}from"./index-C1CPr9I7.js";import{_ as ee}from"./InputLabel-vZ1nCw19.js";import{_ as te}from"./InputError-mYeCkuLg.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-L9kXl_zd.js";const y=S=>(Te("data-v-a29f0598"),S=S(),$e(),S),Ne={class:"py-12"},Ue={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},qe={class:"mb-4"},ze={class:"input-group mb-3"},Ae=y(()=>s("span",{class:"input-group-text",id:"basic-addon1",style:{"background-color":"white"}},[s("i",{class:"fas fa-search"})],-1)),Fe={class:"d-flex justify-content-between mb-3"},je=y(()=>s("option",{value:""},"Serviciu",-1)),Be=["value"],Ee=y(()=>s("option",{value:""},"Județ",-1)),Je=["value"],We=y(()=>s("option",{value:""},"Oraș",-1)),Ye=["value"],Ke=["aria-label"],He={key:0},Qe={class:"card-body"},Ze={class:"row"},Ge={class:"col-md-8"},Xe={class:"card-title"},et={class:"card-subtitle mb-2 text-muted"},tt={class:"card-text"},st={class:"card-text text-muted"},at=["href","onClick"],ot=y(()=>s("i",{class:"fas fa-map-marker-alt"},null,-1)),nt={class:"col-md-4 d-flex flex-column justify-content-between mt-4 md:mt-0",style:{"text-align":"left"}},lt=["onClick"],it={class:"card-text",style:{"font-size":"20px"}},rt=y(()=>s("strong",null,"Preț:",-1)),ct={class:"d-flex justify-content-center align-items-center"},dt={class:"pagination mb-0 custom-pagination"},ut=["onClick"],mt=["value"],vt=["value"],pt={key:1},_t=y(()=>s("div",{class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},[s("div",{class:"p-6 text-gray-900"}," Nu sunt înregistrate servicii momentan. ")],-1)),ft=[_t],gt={class:"p-6"},ht={class:"text-lg font-medium text-gray-900"},wt={class:"mt-1 text-gray-600"},yt={class:"mt-4"},kt=["min","max"],St={key:0,class:"text-danger"},bt={key:0,class:"mt-2"},Ct={class:"mt-2"},xt=["onClick"],Dt={class:"flex items-center justify-end mt-4"},Tt={__name:"AllConsultsClient",props:{consults:Array,appointments:Array},emits:["consult-clicked"],setup(S,{emit:se}){const b=S,j=d([]),q=d(!1),n=Ce({doctor:"",doctor_id:0,service:"",consult_id:0,price:0,date:"",consult_time:0,time:""}),ae=t=>{j.value=t.reviews,q.value=!0},oe=()=>{q.value=!1},ne=se,le=t=>{const a=t.address,e=t.city.name,o=t.county.name;return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(a+", "+e+", "+o)}`},ie=t=>{ne("consult-clicked",t)},V=d(!1),z=d(""),p=d(1),B=[15,25,50,100],C=d(B[0]),I=d(""),L=d(""),M=d(""),x=d("asc"),re=f(()=>[...new Set(b.consults.map(t=>t.service))]),ce=f(()=>[...new Set(b.consults.map(t=>t.county.name))]),de=f(()=>[...new Set(b.consults.map(t=>t.city.name))]),E=f(()=>{const t=z.value.toLowerCase();let a=b.consults.filter(e=>{const o=e.doctor.name.toLowerCase().includes(t)||e.service.toLowerCase().includes(t)||e.city.name.toLowerCase().includes(t)||e.county.name.toLowerCase().includes(t),r=I.value?e.service===I.value:!0,u=L.value?e.county.name===L.value:!0,_=M.value?e.city.name===M.value:!0;return o&&r&&u&&_});return x.value==="asc"?a=a.sort((e,o)=>e.price-o.price):a=a.sort((e,o)=>o.price-e.price),a.map(e=>{const o=e.reviews.reduce((u,_)=>u+_.rating,0),r=e.reviews.length>0?o/e.reviews.length:0;return{...e,averageRating:r}})}),J=f(()=>{const t=(p.value-1)*C.value,a=t+C.value;return E.value.slice(t,a)}),D=f(()=>Math.ceil(E.value.length/C.value)),T=t=>{t>=1&&t<=D.value&&(p.value=t)},ue=t=>{C.value=parseInt(t.target.value),p.value=1},me=()=>{x.value=x.value==="asc"?"desc":"asc"},A=d({}),R=d([]),ve=f(()=>{const t=new Date,a=new Date(t);return a.setDate(t.getDate()+1),a.toISOString().split("T")[0]}),pe=f(()=>{const t=new Date;return t.setFullYear(t.getFullYear()+1),t.toISOString().split("T")[0]}),W=t=>{if(!t)return!0;const e=new Date(t).toLocaleDateString("ro-RO",{weekday:"long"}),o=e.charAt(0).toUpperCase()+e.slice(1);return JSON.parse(A.value)[o].enabled||!1},_e=(t,a)=>{const o=new Date(n.date).toLocaleDateString("ro-RO",{weekday:"long"}),r=o.charAt(0).toUpperCase()+o.slice(1),u=t[r];if(!u||!u.enabled){R.value=[];return}const _=[],N=Y(u.start_time),Se=Y(u.end_time);let U=new Date(N);const be=ge(a);for(;U<Se;)_.push(he(U)),U.setMinutes(U.getMinutes()+be.minutes);R.value=fe(b.appointments,n,_)},fe=(t,a,e)=>{let o=[...e];return t.forEach(r=>{if(r.doctor_id===a.doctor_id&&r.consult_id===a.consult_id&&new Date(r.appointment_date).toISOString().split("T")[0]===a.date){const u=new Date(r.appointment_date).toTimeString().split(":")[0]+":"+new Date(r.appointment_date).toTimeString().split(":")[1];o=o.filter(_=>_!==u)}else if(r.doctor_id===a.doctor_id&&new Date(r.appointment_date).toISOString().split("T")[0]===a.date){const u=new Date(r.appointment_date).toTimeString().split(":")[0]+":"+new Date(r.appointment_date).toTimeString().split(":")[1],_=new Date(r.appointment_date_end).toTimeString().split(":")[0]+":"+new Date(r.appointment_date_end).toTimeString().split(":")[1];o=o.filter(N=>N<u||N>=_)}}),o},Y=t=>{const[a,e]=t.split(":").map(Number),o=new Date;return o.setHours(a,e,0,0),o},ge=t=>{const[a,e,o]=t.split(":").map(Number);return{hours:a,minutes:e,seconds:o}},he=t=>t.toTimeString().slice(0,5),we=t=>{n.doctor=t.doctor.name,n.doctor_id=t.doctor.id,n.consult_id=t.id,n.service=t.service,n.price=t.price,n.consult_time=t.consult_time,A.value=t.doctor.working_days,V.value=!0};xe(()=>n.date,t=>{if(t){const a=n.consult_time;_e(JSON.parse(A.value),a)}});const K=d(null),ye=t=>{K.value=t,n.time=t},H=()=>{V.value=!1,n.reset(),n.errors={},R.value=[]},ke=()=>{n.post(route("consult.client.appointment.store"),{onSuccess:()=>{V.value=!1,n.reset(),Q("Programarea a fost salvată")},onError:()=>{Q("Rezolvă problemele înainte de a salva.","error")}})},Q=(t,a="success")=>{Ie[a](t)};return(t,a)=>(l(),i(g,null,[m(v(De),{title:"Servicii"}),m(Pe,null,{default:$(()=>[s("div",Ne,[s("div",Ue,[s("div",qe,[s("div",ze,[Ae,P(s("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>z.value=e),type:"text",placeholder:"Caută",class:"form-control","aria-label":"Search","aria-describedby":"basic-addon1"},null,512),[[Z,z.value]])]),s("div",Fe,[P(s("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>I.value=e),class:"form-select me-2","aria-label":"Select Service"},[je,(l(!0),i(g,null,h(re.value,e=>(l(),i("option",{key:e,value:e},c(e),9,Be))),128))],512),[[F,I.value]]),P(s("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>L.value=e),class:"form-select me-2","aria-label":"Select County"},[Ee,(l(!0),i(g,null,h(ce.value,e=>(l(),i("option",{key:e,value:e},c(e),9,Je))),128))],512),[[F,L.value]]),P(s("select",{"onUpdate:modelValue":a[3]||(a[3]=e=>M.value=e),class:"form-select me-2","aria-label":"Select City"},[We,(l(!0),i(g,null,h(de.value,e=>(l(),i("option",{key:e,value:e},c(e),9,Ye))),128))],512),[[F,M.value]]),s("button",{class:"btn btn-outline-secondary",onClick:me,"aria-label":`Sort by price ${x.value==="asc"?"ascending":"descending"}`},[s("i",{class:w(x.value==="asc"?"fas fa-arrow-up":"fas fa-arrow-down")},null,2)],8,Ke)])]),J.value.length>0?(l(),i("div",He,[(l(!0),i(g,null,h(J.value,e=>(l(),i("div",{class:"card mb-4 border-gray-200 shadow-lg",key:e.id},[s("div",Qe,[s("div",Ze,[s("div",Ge,[s("h3",Xe," Dr. "+c(e.doctor.name),1),s("h4",et,c(e.service),1),s("p",tt,c(e.description),1),s("p",st,[s("a",{class:"text-muted",style:{"text-decoration":"none"},href:le(e),target:"_blank",onClick:o=>ie(e)},[ot,O(" "+c(e.county.name)+", "+c(e.city.name)+", "+c(e.address),1)],8,at)])]),s("div",nt,[s("div",{onClick:o=>ae(e)},[m(v(Me),{modelValue:e.averageRating,"onUpdate:modelValue":o=>e.averageRating=o,class:"block w-full mb-2",stars:5,readonly:""},null,8,["modelValue","onUpdate:modelValue"])],8,lt),s("p",it,[rt,O(" "+c(e.price)+" Lei ",1)]),s("div",null,[m(X,{onClick:o=>we(e)},{default:$(()=>[O(" Fă o programare ")]),_:2},1032,["onClick"])])])])])]))),128)),s("nav",ct,[s("ul",dt,[s("li",{class:w(["page-item",{disabled:p.value===1}])},[s("a",{class:"page-link",href:"#",onClick:a[4]||(a[4]=k(e=>T(1),["prevent"]))}," << ")],2),s("li",{class:w(["page-item",{disabled:p.value===1}])},[s("a",{class:"page-link",href:"#",onClick:a[5]||(a[5]=k(e=>T(p.value-1),["prevent"]))}," < ")],2),(l(!0),i(g,null,h(D.value,e=>(l(),i("li",{class:w(["page-item",{active:e===p.value}]),key:e},[s("a",{class:"page-link",href:"#",onClick:k(o=>T(e),["prevent"])},c(e),9,ut)],2))),128)),s("li",{class:w(["page-item",{disabled:p.value===D.value}])},[s("a",{class:"page-link",href:"#",onClick:a[6]||(a[6]=k(e=>T(p.value+1),["prevent"]))}," > ")],2),s("li",{class:w(["page-item",{disabled:p.value===D.value}])},[s("a",{class:"page-link",href:"#",onClick:a[7]||(a[7]=k(e=>T(D.value),["prevent"]))}," >> ")],2)]),s("select",{class:"form-select form-select-sm ms-3",onChange:ue,value:C.value,style:{width:"auto"}},[(l(),i(g,null,h(B,e=>s("option",{key:e,value:e},c(e),9,vt)),64))],40,mt)])])):(l(),i("div",pt,ft))])]),m(Oe,{show:V.value,onClose:H,style:{height:"500px"}},{default:$(()=>[s("div",gt,[s("h2",ht," Dorești să faci o programare la Dr. "+c(v(n).doctor)+" pentru "+c(v(n).service)+"? ",1),s("p",wt," Prețul va fi de "+c(v(n).price)+" Lei. Plata nu se face în avans. ",1),s("form",{onSubmit:k(ke,["prevent"])},[s("div",yt,[m(ee,{for:"appointmentDate",value:"Selectează data programării",required:!0}),P(s("input",{type:"date",id:"appointmentDate","onUpdate:modelValue":a[8]||(a[8]=e=>v(n).date=e),min:ve.value,max:pe.value,class:"mt-1 block w-full p-2 border border-gray-300 rounded-md"},null,8,kt),[[Z,v(n).date]]),m(te,{class:"mt-2",message:v(n).errors.date},null,8,["message"]),W(v(n).date)?G("",!0):(l(),i("p",St," Medicul nu are program în această zi. "))]),v(n).date&&W(v(n).date)?(l(),i("div",bt,[m(ee,{value:"Selectează ora programării",required:!0}),s("div",Ct,[(l(!0),i(g,null,h(R.value,e=>(l(),i("span",{key:e,class:w(["badge",{"badge-selected":e===K.value}]),onClick:o=>ye(e)},c(e),11,xt))),128))]),m(te,{class:"mt-2",message:v(n).errors.time},null,8,["message"])])):G("",!0),s("div",Dt,[m(X,{type:"submit"},{default:$(()=>[O("Salvează")]),_:1}),m(Ve,{onClick:H,class:"ms-3"},{default:$(()=>[O(" Închide ")]),_:1})])],32)])]),_:1},8,["show"]),m(Le,{show:q.value,reviews:j.value,onClose:oe},null,8,["show","reviews"])]),_:1})],64))}},zt=Re(Tt,[["__scopeId","data-v-a29f0598"]]);export{zt as default};
